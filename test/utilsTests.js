"use strict";
const expect = require("chai").expect;
const utils = require("../lib/utils");

describe("Test swapToSignedUrls", () => {
    it("S3 urls should be presigned", () => {
        let o = {"data":{"allItems":{"edges":[{"node":{"nodeId":"WyJpdGVtcyIsMl0=","src":"https://s3-eu-west-1.amazonaws.com/pixlcrypt-content/users/pixlcrypt%40gmail.com/src/28973449265_07e3aa5d2e_b.jpg","caption":"After Rain (Jeshu John - designerspics.com)","description":"Totally awesome stuff","itemTagsByItemId":{"edges":[{"node":{"tagByTagId":{"key":"Nature","val":"Nature"}}},{"node":{"tagByTagId":{"key":"Flora","val":"Flora"}}}]},"thumbsByItemId":{"edges":[{"node":{"src":"https://c2.staticflickr.com/9/8817/28973449265_07e3aa5d2e_n.jpg","height":174,"width":320}}]}}},{"node":{"nodeId":"WyJpdGVtcyIsM10=","src":"https://c2.staticflickr.com/9/8356/28897120681_3b2c0f43e0_b.jpg","caption":"Boats (Jeshu John - designerspics.com)","description":null,"itemTagsByItemId":{"edges":[]},"thumbsByItemId":{"edges":[{"node":{"src":"https://c2.staticflickr.com/9/8356/28897120681_3b2c0f43e0_n.jpg","height":212,"width":320}}]}}},{"node":{"nodeId":"WyJpdGVtcyIsNF0=","src":"https://c4.staticflickr.com/9/8887/28897124891_98c4fdd82b_b.jpg","caption":"Color Pencils (Jeshu John - designerspics.com)","description":null,"itemTagsByItemId":{"edges":[]},"thumbsByItemId":{"edges":[{"node":{"src":"https://c4.staticflickr.com/9/8887/28897124891_98c4fdd82b_n.jpg","height":212,"width":320}}]}}},{"node":{"nodeId":"WyJpdGVtcyIsNV0=","src":"https://c7.staticflickr.com/9/8546/28354329294_bb45ba31fa_b.jpg","caption":"Red Apples with other Red Fruit (foodiesfeed.com)","description":null,"itemTagsByItemId":{"edges":[]},"thumbsByItemId":{"edges":[{"node":{"src":"https://c7.staticflickr.com/9/8546/28354329294_bb45ba31fa_n.jpg","height":213,"width":320}}]}}},{"node":{"nodeId":"WyJpdGVtcyIsNl0=","src":"https://c6.staticflickr.com/9/8890/28897154101_a8f55be225_b.jpg","caption":"37H (gratispgraphy.com)","description":null,"itemTagsByItemId":{"edges":[]},"thumbsByItemId":{"edges":[{"node":{"src":"https://c6.staticflickr.com/9/8890/28897154101_a8f55be225_n.jpg","height":183,"width":320}}]}}},{"node":{"nodeId":"WyJpdGVtcyIsN10=","src":"https://c5.staticflickr.com/9/8768/28941110956_b05ab588c1_b.jpg","caption":"8H (gratisography.com)","description":null,"itemTagsByItemId":{"edges":[{"node":{"tagByTagId":{"key":"Nature","val":"Nature"}}}]},"thumbsByItemId":{"edges":[{"node":{"src":"https://c5.staticflickr.com/9/8768/28941110956_b05ab588c1_n.jpg","height":320,"width":240}}]}}},{"node":{"nodeId":"WyJpdGVtcyIsOF0=","src":"https://c3.staticflickr.com/9/8583/28354353794_9f2d08d8c0_b.jpg","caption":"286H (gratisography.com)","description":null,"itemTagsByItemId":{"edges":[]},"thumbsByItemId":{"edges":[{"node":{"src":"https://c3.staticflickr.com/9/8583/28354353794_9f2d08d8c0_n.jpg","height":190,"width":320}}]}}},{"node":{"nodeId":"WyJpdGVtcyIsOV0=","src":"https://c7.staticflickr.com/9/8569/28941134686_d57273d933_b.jpg","caption":"315H (gratisography.com)","description":null,"itemTagsByItemId":{"edges":[{"node":{"tagByTagId":{"key":"People","val":"People"}}}]},"thumbsByItemId":{"edges":[{"node":{"src":"https://c7.staticflickr.com/9/8569/28941134686_d57273d933_n.jpg","height":148,"width":320}}]}}},{"node":{"nodeId":"WyJpdGVtcyIsMTBd","src":"https://c6.staticflickr.com/9/8342/28897193381_800db6419e_b.jpg","caption":"201H (gratisography.com)","description":null,"itemTagsByItemId":{"edges":[]},"thumbsByItemId":{"edges":[{"node":{"src":"https://c6.staticflickr.com/9/8342/28897193381_800db6419e_n.jpg","height":213,"width":320}}]}}},{"node":{"nodeId":"WyJpdGVtcyIsMTFd","src":"https://c2.staticflickr.com/9/8239/28897202241_1497bec71a_b.jpg","caption":"Big Ben (Tom Eversley - isorepublic.com)","description":"Big Ben - London","itemTagsByItemId":{"edges":[]},"thumbsByItemId":{"edges":[{"node":{"src":"https://c2.staticflickr.com/9/8239/28897202241_1497bec71a_n.jpg","height":320,"width":248}}]}}}]}}};
        let email = "pixlcrypt@gmail.com";
        let res = utils.swapToSignedUrls(o, email);
        expect(res.data.allItems.edges[0].node.src.startsWith("https://pixlcrypt-content.s3.eu-west-1.amazonaws.com/users/pixlcrypt%40gmail.com/src/28973449265_07e3aa5d2e_b.jpg?X-Amz-Algorithm")).to.be.true;
    });
});
